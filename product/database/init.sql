DROP SCHEMA public CASCADE;

CREATE SCHEMA public AUTHORIZATION postgres;

-- Соц. Дем. Кластер
CREATE TABLE public.cluster (
    cluster_id int8 NOT NULL,
    description varchar NOT NULL,
    CONSTRAINT cluster_pk PRIMARY KEY (cluster_id)
);

-- Таблица пользователей
CREATE TABLE public."user" (
	user_id int8 NOT NULL,
    cluster_id int8,
	"name" varchar,
	CONSTRAINT user_pk PRIMARY KEY (user_id),
    CONSTRAINT cluster_fk FOREIGN KEY (cluster_id) REFERENCES public.cluster(cluster_id)
);

-- Таблица брендов
CREATE TABLE public.brand (
	brand_id int8 NOT NULL,
	"name" varchar,
	CONSTRAINT brand_pk PRIMARY KEY (brand_id)
);

-- Таблица товаров для marketplace
CREATE TABLE public.marketplace_item (
	item_id varchar NOT NULL,
	category varchar,
	brand_id int8,
	price numeric(10, 2),
	CONSTRAINT marketplace_item_pk PRIMARY KEY (item_id),
	CONSTRAINT marketplace_item_brand_fk FOREIGN KEY (brand_id) REFERENCES public.brand(brand_id)
);

-- Таблица товаров для retail
CREATE TABLE public.retail_item (
	item_id varchar NOT NULL,
	category varchar,
	brand_id int8,
	price numeric(10, 2),
	CONSTRAINT retail_item_pk PRIMARY KEY (item_id),
	CONSTRAINT retail_item_brand_fk FOREIGN KEY (brand_id) REFERENCES public.brand(brand_id)
);

-- Таблица товаров для offers
CREATE TABLE public.offers_item (
	item_id varchar NOT NULL,
	category varchar,
	brand_id int8,
	price numeric(10, 2),
	CONSTRAINT offers_item_pk PRIMARY KEY (item_id),
	CONSTRAINT offers_item_brand_fk FOREIGN KEY (brand_id) REFERENCES public.brand(brand_id)
);

-- Таблица событий
CREATE TABLE public.event (
	event_id bigserial NOT NULL,
	user_id int8 NOT NULL,
	item_id varchar NOT NULL,
	channel varchar(50) NOT NULL,
	action_type varchar(50) NOT NULL,
	timestamp int8 NOT NULL,
	price numeric(10, 2),
	category varchar,
	brand_id int8,
	CONSTRAINT event_pk PRIMARY KEY (event_id),
	CONSTRAINT event_user_fk FOREIGN KEY (user_id) REFERENCES public."user"(user_id)
);

CREATE INDEX idx_event_user_id ON public.event(user_id);
CREATE INDEX idx_event_item_id ON public.event(item_id);
CREATE INDEX idx_event_channel ON public.event(channel);
CREATE INDEX idx_event_timestamp ON public.event(timestamp);
CREATE INDEX idx_event_user_channel ON public.event(user_id, channel);
CREATE INDEX idx_marketplace_item_category ON public.marketplace_item(category);
CREATE INDEX idx_retail_item_category ON public.retail_item(category);
CREATE INDEX idx_offers_item_category ON public.offers_item(category);

-- Вставка данных в таблицу cluster
INSERT INTO public.cluster (cluster_id, description) VALUES
(0, 'Кластер представляет активных мастеров-хозяев. Их покупательское поведение сфокусировано на товарах для ремонта, строительства, домашнего хозяйства и автомобиля. Они входят в ТОП-5 по категориям автозапчастей, стройматериалов, товаров для дома и дачи, хозяйственных товаров и одежды, при этом не имеют выраженных анти-предпочтений. Высокая активность и средние траты подтверждают портрет людей, которые много делают своими руками, возможно, владельцев частных домов или активных автомобилистов.'),
(1, 'Кластер - это гиперспециализированные покупатели продуктов питания. Более 90% их покупок составляют еда и напитки, при этом они сознательно избегают покупок в большинстве непродовольственных категорий, включая автоаксессуары, мебель, технику и одежду. Высокая активность и средние траты характерны для людей, чьи потребительские интересы сосредоточены исключительно на пищевой корзине, возможно, одиноких людей или пожилых людей с фиксированными привычками.'),
(2, 'Кластер представляет ультра-специализированных потребителей продуктов питания. 94% их покупок - это еда и напитки, при этом они входят в анти-топ по детским товарам, косметике, одежде и товарам для питомцев. Высокая активность и средние траты рисуют портрет людей, которые часто покупают продукты, но практически не интересуются другими товарными категориями, что может указывать на узкоспециализированный образ жизни.'),
(3, 'Кластер - это сверхспециализированные покупатели косметики и товаров для ухода. Более 60% их покупок приходится на косметику, еще около 5% - на детские товары. При этом они входят в анти-топ по всем без исключения остальным категориям. Экстремально низкая активность при средних тратах может указывать на профессионального визажиста, бьюти-блогера или человека с глубокой личной увлеченностью сферой ухода за собой.'),
(4, 'Кластер представляет молодых активных потребителей или увлеченных хоббистов. Их покупки сосредоточены на электронике, гаджетах, одежде, обуви, товарах для спорта, хобби и питомцев. Это типичный паттерн поведения молодежи или молодых пар без детей, которые тратят деньги на себя, свои увлечения и образ жизни. Низкая активность может быть связана с более точечным, но дорогим покупательским поведением.'),
(5, 'Кластер - это заботливые семьянины с широким профилем покупок. Их потребительская корзина охватывает 12 категорий, включая детские товары, косметику, товары для ремонта, питомцев, спорт и лекарства. При этом они сознательно экономят на продуктах питания. Высокие траты при низкой активности указывают на семью, которая делает крупные, продуманные покупки, перераспределяя бюджет с базовых продуктов на обустройство дома и заботу о семье.'),
(6, 'Кластер представляет покупателей товаров для дома и ухода, экономящих на продуктах. Они входят в ТОП-5 по категориям хозтоваров, косметики, товаров для дома и питомцев, при этом более половины их покупок избегают продуктовой категории. Низкая активность и средние траты характерны для людей, сфокусированных на ведении домашнего хозяйства, но не склонных к частым покупкам.'),
(7, 'Кластер - это здоровые автолюбители. Их ключевые категории покупок - автоаксессуары и фармацевтика, с небольшими долями обуви и печатной продукции. Это портрет людей, которые заботятся о своем автомобиле и здоровье, возможно, среднего и старшего возраста. Низкая активность и средние траты говорят о регулярных, но не массовых покупках в специфических категориях.'),
(8, 'Кластер представляет сверхактивных потребителей продуктов питания. 96% их покупок - это еда и напитки, при этом они имеют самую высокую активность среди всех кластеров. Это может быть большая семья, делающая очень частые закупки, или человек, закупающий продукты для небольшого коллектива. Уникальная комбинация экстремальной продуктовой специализации и максимальной активности выделяет этот кластер.'),
(9, 'Кластер - это заботливые родители с детьми школьного или дошкольного возраста. Их расходы связаны с образованием, развитием и досугом ребенка - они входят в ТОП-5 по детским товарам, товарам для хобби, канцелярии и печатной продукции. Активность выше среднего и сбалансированные траты указывают на стабильное финансовое положение семьи, где приоритет отдается детским потребностям.'),
(10, 'Кластер представляет домашних практиков с акцентом на электронику и одежду. Их покупательская корзина сфокусирована на товарах для дома, уборки, ремонта и питомцев, при этом они экономят на продуктах. В отличие от похожих кластеров, здесь заметны покупки электроники и одежды, что может указывать на более молодой возраст потребителей. Активность выше среднего подтверждает вовлеченность в процесс обустройства быта.'),
(11, 'Кластер - это сверхактивные покупатели продуктов с максимальной вовлеченностью. 90% их покупок составляют продукты питания, при этом они демонстрируют абсолютно максимальную активность - в 1.88 раза выше среднего. Такой паттерн может указывать на коммерческого покупателя, например, владельца маленького кафе, закупающего продукты по розничным картам, или на очень большую семью с экстремально высокими пищевыми потребностями.'),
(12, 'Кластер представляет малоактивных консерваторов. Наиболее примечательная черта - сознательное игнорирование косметики и товаров для личного ухода, где они входят в анти-топ. В остальном их профиль покупок ничем не выделяется. Средние активность и траты характерны для людей с невысокой вовлеченностью в потребление, возможно, пожилых людей или приверженцев строгой бюджетной политики.'),
(13, 'Кластер - это модники, заботящиеся о внешности. Их покупки почти исключительно сконцентрированы на одежде и косметике, при этом они входят в анти-топ по всем остальным категориям. Низкая активность при высоких тратах говорит о покупках дорогих брендов и целенаправленном шопинге. Это очень узкоспециализированная группа, для которой самопрезентация является основным потребительским приоритетом.'),
(15, 'Кластер представляет покупателей средств для уборки и ухода. Их ключевые категории - косметика, товары для уборки и товары категории другое, при этом они избегают покупок электроники, стройматериалов и канцелярии. Низкая активность и средние траты характерны для людей, ответственных за ведение домашнего хозяйства в семье, с четко очерченным кругом потребительских интересов.'),
(16, 'Кластер - это сверхспециализированные покупатели продуктов питания. 95% их покупок - это еда и напитки, при этом они входят в анти-топ по всем без исключения непродовольственным категориям. Экстремально низкая активность при средних тратах указывает на очень узкую потребительскую специализацию, возможно, связанную с особыми пищевыми привычками или ограниченными потребностями.'),
(17, 'Кластер представляет универсальных практичных потребителей. Их покупательская корзина очень широка и включает товары для автомобиля, детей, ремонта, электроники, мебели, фармацевтики и спорта без выраженных анти-предпочтений. Средние активность и траты характерны для рациональных покупателей, не склонных к импульсным покупкам, возможно, больших семей, которые централизованно закупают товары для разных сфер жизни.'),
(18, 'Кластер - это увлеченные любители животных и здорового образа жизни. Их ключевые покупки - товары для питомцев, спорт, фармацевтика и хобби. Высокие траты при низкой активности подтверждают модель качественных и специализированных покупок. Это люди, для которых питомец - полноценный член семьи, а собственное здоровье и активный досуг являются важными жизненными приоритетами.'),
(19, 'Кластер представляет узкоспециализированных покупателей канцелярских товаров. Единственная категория, где они входят в ТОП-5 - это канцелярия. Низкая активность и невысокие траты могут указывать на офисного менеджера, закупающего supplies для всего офиса, или человека, чья профессиональная деятельность связана с большим расходом таких материалов. Это крайне специализированный потребительский профиль.'),
(20, 'Кластер - это крупнейший сегмент семей с детьми, проживающих в собственном жилье, требующем обустройства. Эти домашние практики фокусируются на товарах для ведения хозяйства, ремонта и заботы о детях, при этом сознательно экономят на ежедневных продуктах питания. Активность выше среднего подтверждает вовлеченность в процесс обустройства быта. Их потребительское поведение характеризуется стратегией перераспределения бюджета с базовых продуктов на обустройство жилья и детей.'),
(21, 'Кластер представляет малоактивных консерваторов, игнорирующих косметику и товары для ухода. Они входят в анти-топ по косметической категории, но их активность значительно ниже среднего, а траты чуть выше. Это может быть пассивная группа пожилых людей или людей с очень консервативными потребительскими привычками, которые редко пробуют что-то новое и придерживаются минималистичного подхода к покупкам.');