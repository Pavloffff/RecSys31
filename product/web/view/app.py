import streamlit as st
import json

data = """
{
  "recommendations": [
    {
      "product_name": "Накопительный счет «Акцент на процент»",
      "priority": 1,
      "reasoning": "Клиент проявляет активность (20.8 дней активности, 6.33 событий в день) и имеет мультиканальность с предпочтительным каналом 'offers'. Это указывает на потенциальную готовность использовать карту для покупок, что является условием для получения максимальной ставки по этому накопительному счету.",
      "key_benefits": [
        "До 17% годовых, если клиент будет активно пользоваться картой ПСБ для покупок.",
        "Начисление % на ежедневный остаток, что удобно для активного пользователя.",
        "Соответствует интересу к 'offers' (предложениям) за счет дополнительной выгоды."
      ],
      "marketing_strategy": "Акцент на выгоду от активного использования карты: персонализированное push-уведомление с расчетом потенциального дохода при текущем уровне активности.",
      "consequences": "Повышение лояльности за счет демонстрации персональной выгоды; стимулирование покупок по карте для максимизации ставки.",
      "match_score": 0.95
    },
    {
      "product_name": "Накопительный счет «Про запас»",
      "priority": 2,
      "reasoning": "При низких общих тратах (1.28 ₽) и отсутствии покупок, клиент может быть заинтересован в накоплениях с возможностью пополнения и снятия. Высокий процент на первые два месяца может стимулировать начало накоплений, а начисление процентов на минимальный остаток поможет избежать импульсивных трат.",
      "key_benefits": [
        "До 15% годовых в первые 2 месяца для старта накоплений.",
        "Пополнение и снятие без ограничений, что дает гибкость.",
        "Механизм начисления процентов на минимальный остаток может помочь контролировать расходы."
      ],
      "marketing_strategy": "Запуск onboarding-кампании с фокусом на «финансовую подушку»: email + баннер в приложении с калькулятором доходности за 2 месяца.",
      "consequences": "Формирование привычки к регулярным накоплениям; снижение склонности к импульсивным тратам.",
      "match_score": 0.9
    },
    {
      "product_name": "Вклад «Мой доход»",
      "priority": 3,
      "reasoning": "Учитывая отсутствие покупок и низкие траты, клиент может быть осторожным в финансовых решениях. 'Мой доход' доступен для всех и имеет надбавку для пенсионеров, зарплатных клиентов, что может быть актуально, если его социально-демографический кластер 18.0 связан с определенными льготами или статусом. Участие в акции 'Бонус за вклад' добавляет привлекательности.",
      "key_benefits": [
        "Доступен для всех, что снижает барьеры для открытия.",
        "Возможна надбавка до +1.00% для пенсионеров, зарплатных клиентов и клиентов ОПК/ОПС+.",
        "Участие в акции «Бонус за вклад» (сертификат на 3000 ₽)."
      ],
      "marketing_strategy": "Целевое предложение с акцентом на «гарантированный доход + бонус» через SMS и баннер в личном кабинете с упоминанием льготной надбавки.",
      "consequences": "Укрепление доверия к банку за счет прозрачности и дополнительной ценности; возможное выявление скрытого статуса (зарплатный/пенсионер).",
      "match_score": 0.85
    },
    {
      "product_name": "Акция «Лучше ноль» - Верните все проценты по кредиту",
      "priority": 4,
      "reasoning": "Несмотря на отсутствие покупок, клиент проявил интерес к продуктам (19 просмотров, 1 клик). Акция 'Лучше ноль' привлекательна для тех, кто рассматривает кредит, но хочет минимизировать затраты. Возможно, клиент изучал кредитные предложения, и эта акция может снять опасения по поводу переплаты.",
      "key_benefits": [
        "Возврат всех процентов по кредиту баллами, что является значительной выгодой.",
        "Снижает общую стоимость кредита при своевременном погашении.",
        "Привлекательное предложение для тех, кто рассматривает заемные средства."
      ],
      "marketing_strategy": "Ретаргетинг по просмотру кредитных продуктов: push с сообщением «Мы вернём вам все проценты — платите только тело кредита».",
      "consequences": "Снижение воспринимаемого риска по кредитованию; рост конверсии в оформление кредита.",
      "match_score": 0.75
    },
    {
      "product_name": "Кешбэк и скидки от партнеров (Техника)",
      "priority": 5,
      "reasoning": "Топ категория интереса клиента - 'Electronic Devices and Gadgets'. Предложения по кешбэку на технику (multinel, ReadySkin, Rokodil, galaxystore, Билайн, Restore, Krona, МегаФон) напрямую соответствуют его предпочтениям, даже при низких текущих тратах. Это может стимулировать будущие покупки.",
      "key_benefits": [
        "Прямое соответствие интересам клиента ('Electronic Devices and Gadgets').",
        "Кешбэк до 10% на покупки в магазинах электроники.",
        "Может стимулировать совершение покупок в интересующей категории."
      ],
      "marketing_strategy": "Персонализированный дайджест с подборкой акций от партнеров по технике с возможностью активации кешбэка в один клик.",
      "consequences": "Стимулирование первой покупки по рекомендации; усиление привязки к экосистеме банка через партнерские программы.",
      "match_score": 0.7
    }
  ],
  "summary": "Клиент с ID 25770580 проявляет умеренную активность в изучении предложений, но пока не совершал покупок. Его основной интерес сосредоточен на 'Electronic Devices and Gadgets'. Рекомендуются накопительные счета как способ начать сберегать при низких текущих тратах, а также акции по кредитам и кешбэк-программы, соответствующие его интересам в технике, чтобы стимулировать дальнейшее взаимодействие с банком."
}
"""

recommendations = json.loads(data)["recommendations"]
summary = json.loads(data)["summary"]

col1, col2 = st.columns([0.2, 0.8])
with col1:
    st.image(
        "../assets/PSB_logo_white.png",
        width=800,
    )
with col2:
    st.title("RecSys31")

with st.form("my_form"):
    user_id = st.text_input("Введите id пользователя:")
    st.form_submit_button("Отправить")

st.header("Общая характеристика клиента:")
st.info(summary)

st.header("Рекомендованные продукты:")

sorted_recommendations = sorted(recommendations, key=lambda x: x["priority"])

for rec in sorted_recommendations:
    with st.container():
        col1, col2 = st.columns([4, 1])
        with col1:
            st.subheader(f"{rec['priority']}. {rec['product_name']}")
        with col2:
            st.metric("Match Score", f"{rec['match_score']*100}%")

        st.write(f"**Обоснование:** {rec['reasoning']}")

        st.write("**Ключевые преимущества:**")
        for benefit in rec["key_benefits"]:
            st.write(f"• {benefit}")

        with st.expander("Маркетинговая стратегия"):
            st.write(rec["marketing_strategy"])

        with st.expander("Ожидаемый эффект"):
            st.write(rec["consequences"])

        st.markdown("---")
